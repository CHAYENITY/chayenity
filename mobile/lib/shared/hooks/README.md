# üöÄ API Service & Query Hooks Documentation (Updated for API Response Format)

## Overview

‡∏£‡∏∞‡∏ö‡∏ö API Service ‡πÅ‡∏•‡∏∞ Query Hooks ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÉ‡∏ô Flutter app ‡∏î‡πâ‡∏ß‡∏¢ Riverpod ‡πÅ‡∏ö‡∏ö best practice ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö standardized API response format

## üìÅ File Structure

```
lib/shared/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ api.dart                 # API response models
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ api_service.dart         # Core API service
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ use_query.dart          # Query hooks & providers
‚îÇ   ‚îú‚îÄ‚îÄ example_usage.dart      # ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
‚îÇ   ‚îî‚îÄ‚îÄ README.md               # Documentation
‚îî‚îÄ‚îÄ constants/
    ‚îî‚îÄ‚îÄ api_endpoints.dart      # API endpoints
```

## üîß Features

### ApiService

- ‚úÖ Generic CRUD operations (GET, POST, PUT, PATCH, DELETE)
- ‚úÖ **Standardized API response handling**
- ‚úÖ **Pagination support with metadata**
- ‚úÖ Custom endpoints support
- ‚úÖ Error handling & retry mechanism
- ‚úÖ Request/Response logging
- ‚úÖ Authentication token management
- ‚úÖ Timeout configuration
- ‚úÖ **API success/error validation**

### Query Hooks

- ‚úÖ Type-safe query states
- ‚úÖ **Paginated query support**
- ‚úÖ Loading & error states
- ‚úÖ Automatic refetch capabilities
- ‚úÖ **Pagination controls (page, search, sort)**
- ‚úÖ Mutation states with success tracking
- ‚úÖ Easy-to-use helper functions
- ‚úÖ Riverpod integration

## üì¶ API Response Format

### Standard Response (Single Item)

```json
{
  "data": T | null,
  "message": "Success" | "Error message",
  "success": true | false
}
```

### Paginated Response (List)

```json
{
  "data": T[],
  "meta": {
    "total": 100,
    "page": 1,
    "limit": 10,
    "totalPages": 10
  },
  "message": "Success" | "Error message",
  "success": true | false
}
```

## üéØ Quick Start

### 1. Basic Usage

```dart
// üìã Get paginated list of entities
final usersProvider = useEntityList<User>(
  ApiEndpoints.users,
  fromJson: User.fromJson,
  pagination: const PaginationParams(limit: 10),
);

// üìÑ Get entity by ID
final userProvider = useEntityById<User>(
  ApiEndpoints.users,
  userId,
  fromJson: User.fromJson,
);

// ‚ûï Create entity
final createUserProvider = useCreateEntity<User>(
  ApiEndpoints.users,
  fromJson: User.fromJson,
);
```

### 2. In Widget

```dart
class MyWidget extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final usersState = ref.watch(usersProvider);

    if (usersState.isLoading) {
      return CircularProgressIndicator();
    }

    if (usersState.hasError) {
      return Text('Error: ${usersState.error}');
    }

    return Column(
      children: [
        // List
        Expanded(
          child: ListView.builder(
            itemCount: usersState.data?.length ?? 0,
            itemBuilder: (context, index) {
              final user = usersState.data![index];
              return ListTile(
                title: Text(user.name),
                subtitle: Text(user.email),
              );
            },
          ),
        ),

        // Pagination info
        if (usersState.meta != null)
          Text('Page ${usersState.meta!.page} of ${usersState.meta!.totalPages}'),
      ],
    );
  }
}
```

### 3. Mutations

```dart
// Create
await ref.read(createUserProvider.notifier).mutate({
  'name': 'John Doe',
  'email': 'john@example.com',
});

// Update
await ref.read(updateUserProvider.notifier).mutate(userId, {
  'name': 'Jane Doe',
});

// Delete
await ref.read(deleteUserProvider.notifier).mutate(userId);
```

### 4. Pagination Controls

```dart
final usersNotifier = ref.read(usersListProvider.notifier);

// Load specific page
usersNotifier.loadPage(2);

// Search
usersNotifier.search('john');

// Sort
usersNotifier.sort('name', 'asc');

// Refresh
usersNotifier.refresh();
```

## üìö API Reference

### useEntityList<T>() **[UPDATED]**

```dart
StateNotifierProvider<EntityListNotifier<T>, PaginatedQueryState<T>>
useEntityList<T>(
  String endpoint, {
  T Function(Map<String, dynamic>)? fromJson,
  PaginationParams? pagination,  // NEW
  String? name,
})
```

### PaginationParams

```dart
class PaginationParams {
  final int? page;
  final int? limit;
  final String? search;
  final String? sortBy;
  final String? sortOrder; // 'asc' | 'desc'
}
```

### useEntityById<T>()

```dart
StateNotifierProvider<EntityByIdNotifier<T>, QueryState<T>>
useEntityById<T>(
  String endpoint,
  dynamic id, {
  T Function(Map<String, dynamic>)? fromJson,
  Map<String, dynamic>? queryParameters,
  String? name,
})
```

### useCreateEntity<T>()

```dart
StateNotifierProvider<CreateMutationNotifier<T>, MutationState<T>>
useCreateEntity<T>(
  String endpoint, {
  T Function(Map<String, dynamic>)? fromJson,
  String? name,
})
```

### useUpdateEntity<T>()

```dart
StateNotifierProvider<UpdateMutationNotifier<T>, MutationState<T>>
useUpdateEntity<T>(
  String endpoint, {
  T Function(Map<String, dynamic>)? fromJson,
  String? name,
})
```

### useDeleteEntity()

```dart
StateNotifierProvider<DeleteMutationNotifier, MutationState<bool>>
useDeleteEntity(
  String endpoint, {
  String? name,
})
```

### useCustomQuery<T>()

```dart
StateNotifierProvider<CustomQueryNotifier<T>, QueryState<T>>
useCustomQuery<T>(
  String endpoint, {
  T Function(Map<String, dynamic>)? fromJson,
  Map<String, dynamic>? queryParameters,
  String? name,
})
```

### useCustomMutation<T>()

```dart
StateNotifierProvider<CustomMutationNotifier<T>, MutationState<T>>
useCustomMutation<T>(
  String endpoint, {
  T Function(Map<String, dynamic>)? fromJson,
  String? name,
})
```

## üîÑ State Management

### QueryState<T>

```dart
class QueryState<T> {
  final T? data;            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å response.data
  final bool isLoading;     // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î
  final String? error;      // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
  final bool hasError;      // ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
}
```

### PaginatedQueryState<T> **[NEW]**

```dart
class PaginatedQueryState<T> {
  final List<T>? data;         // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å response.data
  final PaginationMeta? meta;  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• pagination
  final bool isLoading;        // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î
  final String? error;         // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
  final bool hasError;         // ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
}
```

### MutationState<T>

```dart
class MutationState<T> {
  final T? data;            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å response.data
  final bool isLoading;     // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î
  final String? error;      // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
  final bool hasError;      // ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  final bool isSuccess;     // response.success
}
```

### PaginationMeta **[NEW]**

```dart
class PaginationMeta {
  final int total;          // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  final int page;           // ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
  final int limit;          // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤
  final int totalPages;     // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
}
```

## üé® Best Practices

### 1. Model Definition

```dart
class User {
  final int id;
  final String name;
  final String email;

  User({required this.id, required this.name, required this.email});

  factory User.fromJson(Map<String, dynamic> json) {
    return User(
      id: json['id'] as int,
      name: json['name'] as String,
      email: json['email'] as String,
    );
  }

  Map<String, dynamic> toJson() {
    return {
      'id': id,
      'name': name,
      'email': email,
    };
  }
}
```

### 2. Provider Creation

```dart
// ‡∏™‡∏£‡πâ‡∏≤‡∏á providers ‡πÉ‡∏ô file ‡πÅ‡∏¢‡∏Å
final usersListProvider = useEntityList<User>(
  ApiEndpoints.users,
  fromJson: User.fromJson,
  pagination: const PaginationParams(limit: 10),
  name: 'UsersListProvider',
);

final createUserProvider = useCreateEntity<User>(
  ApiEndpoints.users,
  fromJson: User.fromJson,
  name: 'CreateUserProvider',
);
```

### 3. Error Handling **[UPDATED]**

```dart
if (state.hasError) {
  return Column(
    children: [
      Text('Error: ${state.error}'),
      ElevatedButton(
        onPressed: () => ref.read(provider.notifier).refresh(),
        child: Text('Retry'),
      ),
    ],
  );
}
```

### 4. Success Handling **[UPDATED]**

```dart
// ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö mutation - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö response.success
if (mutationState.isSuccess) {
  // Handle success
  ref.read(listProvider.notifier).refresh(); // Refresh list
  ref.read(mutationProvider.notifier).reset(); // Reset state
}

if (mutationState.hasError) {
  // Show error message
  ScaffoldMessenger.of(context).showSnackBar(
    SnackBar(content: Text('Error: ${mutationState.error}')),
  );
}
```

### 5. Pagination UI **[NEW]**

```dart
// Pagination controls
if (state.meta != null && state.meta!.totalPages > 1) {
  Row(
    mainAxisAlignment: MainAxisAlignment.spaceBetween,
    children: [
      ElevatedButton(
        onPressed: state.meta!.page > 1
            ? () => notifier.loadPage(state.meta!.page - 1)
            : null,
        child: const Text('Previous'),
      ),
      Text('Page ${state.meta!.page} of ${state.meta!.totalPages}'),
      ElevatedButton(
        onPressed: state.meta!.page < state.meta!.totalPages
            ? () => notifier.loadPage(state.meta!.page + 1)
            : null,
        child: const Text('Next'),
      ),
    ],
  );
}
```

## üîê Authentication

```dart
// Set auth token
final apiService = ref.read(apiServiceProvider);
apiService.setAuthToken(token);

// Remove auth token
apiService.removeAuthToken();
```

## üêõ Error Handling **[UPDATED]**

API Service ‡∏à‡∏∞:

1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö `response.success` field
2. Throw exception ‡∏ñ‡πâ‡∏≤ `success: false`
3. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ standard HTTP errors:
   - Connection timeout
   - No internet connection
   - 401 Unauthorized
   - 403 Forbidden
   - 404 Not Found
   - 500 Server Error

## üîç Logging

API Service ‡∏à‡∏∞ log ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:

- üöÄ Request details
- ‚úÖ Response data
- ‚ùå Error information
- üìä API success/failure status

## üí° Tips **[UPDATED]**

1. **‡πÉ‡∏ä‡πâ `PaginationParams`** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö list queries
2. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö `isSuccess`** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö mutations
3. **Reset mutation state** ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à
4. **Refresh list** ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å create/update/delete
5. **Handle loading states** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö UX ‡∏ó‡∏µ‡πà‡∏î‡∏µ
6. **Use fromJson** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö type safety
7. **‡πÅ‡∏™‡∏î‡∏á pagination info** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö list ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏¢‡∏≠‡∏∞
8. **‡πÉ‡∏ä‡πâ search/sort functions** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö UX ‡∏ó‡∏µ‡πà‡∏î‡∏µ

## üìù Example Integration

‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô‡πÉ‡∏ô `example_usage.dart` ‡∏ã‡∏∂‡πà‡∏á‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á:

- Pagination controls
- Search functionality
- Error handling
- Loading states
- Success validation
